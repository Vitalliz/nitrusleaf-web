<%- include ('partials/header.ejs') %> 
<%- include ('partials/navbar-user.ejs') %>

<main class="main-content home-dashboard">
    <%- include ('partials/navbar-lateral.ejs') %>
    <section class="dashboard-container">
        <header class="dashboard-header">
            <div style="display: flex; align-items: center;">
                <a href="/talhoes" style="text-decoration: none; display: flex; align-items: center; margin-right: 8px;">
                    <img src="/imgs/back.svg" alt="Voltar" style="width: 24px; height: 24px;">
                </a>
                <h1 style="margin: 0; font-size: 24px;">Talhão: <%= talhao.nome %></h1>
            </div>
            <a href="/talhoes/edit/<%= talhao.id_talhao %>" class="btn-primary" style="background: #65B741; color: #fff; font-weight: 600; border-radius: 8px; padding: 8px 16px; text-decoration: none; font-size: 14px;">
                Editar Talhão
            </a>
        </header>

        <div style="background: #FAF0D7; border-radius: 14px; padding: 24px; margin-bottom: 24px;">
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">
                <div>
                    <h3 style="font-size: 16px; color: #351102; margin: 0 0 8px 0;">Propriedade</h3>
                    <div style="padding: 10px; border-radius: 8px; background: #fff; font-size: 15px; color: #351102;">
                        <%= talhao.propriedade.nome %>
                    </div>
                </div>
                <div>
                    <h3 style="font-size: 16px; color: #351102; margin: 0 0 8px 0;">Alqueire</h3>
                    <div style="padding: 10px; border-radius: 8px; background: #fff; font-size: 15px; color: #351102;">
                        <%= talhao.alqueire ? talhao.alqueire.nome : 'Sem alqueire' %>
                    </div>
                </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                <div>
                    <h3 style="font-size: 16px; color: #351102; margin: 0 0 8px 0;">Espécie Plantada</h3>
                    <div style="padding: 10px; border-radius: 8px; background: #fff; font-size: 15px; color: #351102;">
                        <%= talhao.especie_fruta %>
                    </div>
                </div>
                <div>
                    <h3 style="font-size: 16px; color: #351102; margin: 0 0 8px 0;">Pés Analisados</h3>
                    <div style="padding: 10px; border-radius: 8px; background: #fff; font-size: 15px; color: #351102;">
                        <%= talhao.pes_analisados %>/<%= talhao.total_pes %>
                    </div>
                </div>
            </div>
        </div>

        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div style="flex-grow: 1;">
                <div style="position: relative; max-width: 300px;">
                    <input type="text" placeholder="Pesquisar registros" style="width: 100%; padding: 10px 40px 10px 16px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                    <div style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%);">
                        <img src="/imgs/search.svg" alt="Pesquisar" style="width: 18px; height: 18px;">
                    </div>
                </div>
            </div>
            <a href="/cadastroPes/<%= talhao.id_talhao %>" class="btn-primary" style="background: #65B741; color: #fff; font-weight: 600; border-radius: 8px; padding: 10px 16px; text-decoration: none; display: flex; align-items: center; gap: 8px; font-size: 14px;">
                <span style="font-size: 18px;">+</span> Adicionar Pé
            </a>
        </div>

        <table style="width: 100%; border-collapse: collapse; background: #fff; border-radius: 12px; overflow: hidden; margin-bottom: 20px;">
            <thead>
                <tr style="border-bottom: 1px solid #F2C48D;">
                    <th style="font-size: 15px; color: #351102; font-weight: 700; padding: 12px 15px; text-align: left;">Nome Pé</th>
                    <th style="font-size: 15px; color: #351102; font-weight: 700; padding: 12px 15px; text-align: center;">Status</th>
                    <th style="font-size: 15px; color: #351102; font-weight: 700; padding: 12px 15px; text-align: center;">Data de Criação</th>
                    <th style="width: 120px;"></th>
                </tr>
            </thead>
            <tbody>
                <% if (pes && pes.length > 0) { %>
                    <% pes.forEach(pe => { %>
                    <tr style="border-bottom: 1px solid #F2C48D;">
                        <td style="font-size: 15px; color: #351102; padding: 12px 15px;"><%= pe.nome %></td>
                        <td style="font-size: 15px; color: #351102; padding: 12px 15px; text-align: center;">
                            <% if (pe.situacao === 'Tratado') { %>
                                <span style="display: inline-flex; align-items: center; gap: 5px;">
                                    <span style="display: inline-block; width: 12px; height: 12px; background-color: #6C5CE7; border-radius: 50%;"></span>
                                    Tratado
                                </span>
                            <% } else if (pe.situacao === 'Não-Tratado') { %>
                                <span style="display: inline-flex; align-items: center; gap: 5px;">
                                    <span style="display: inline-block; width: 12px; height: 12px; background-color: #FF7675; border-radius: 50%;"></span>
                                    Não Tratado
                                </span>
                            <% } else { %>
                                <span style="display: inline-flex; align-items: center; gap: 5px;">
                                    <span style="display: inline-block; width: 12px; height: 12px; background-color: #B2BEC3; border-radius: 50%;"></span>
                                    Sem informações
                                </span>
                            <% } %>
                        </td>
                        <td style="font-size: 15px; color: #351102; padding: 12px 15px; text-align: center;"><%= pe.createdAt.toLocaleDateString() %></td>
                        <td style="text-align: right; padding: 12px 15px;">
                            <div style="display: flex; justify-content: flex-end; gap: 8px;">
                                <a href="/pes/edit/<%= pe.id_pe %>" style="display: inline-flex; align-items: center; background: #f0f0f0; border-radius: 4px; padding: 4px 8px; text-decoration: none; color: #333; font-size: 14px;">
                                    Editar <span style="margin-left: 4px;">▼</span>
                                </a>
                                <a href="/pes/<%= pe.id_pe %>" style="display: inline-block; background: none; border: none;">
                                    <img src="/imgs/setinha.svg" style="width: 22px; height: 22px;" alt="Ir">
                                </a>
                            </div>
                        </td>
                    </tr>
                    <% }) %>
                <% } else { %>
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 24px;">
                            <p style="color: #888; margin: 0;">Nenhum pé cadastrado neste talhão</p>
                        </td>
                    </tr>
                <% } %>
            </tbody>
        </table>
        
        <div style="text-align: center; color: #666; font-size: 14px;">
            1-<%= pes ? pes.length : 0 %>
        </div>
    </section>
</main>

<%- include ('partials/footer.ejs') %>