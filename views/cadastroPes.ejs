<%- include('partials/header.ejs') %>
<%- include('partials/navbar-user.ejs') %>
<main class="main-content home-dashboard">
    <%- include ('partials/navbar-lateral.ejs') %>
    <section class="dashboard-container">
        <header class="dashboard-header">
            <div style="display: flex; align-items: center; gap: 12px;">
                <a href="/histal/<%= talhao.id_talhao %>" style="text-decoration: none; display: flex; align-items: center;">
                    <img src="/imgs/back.svg" alt="Voltar" style="width: 24px; height: 24px;">
                </a>
                <h1>Cadastrar Pé</h1>
            </div>
        </header>

        <section class="analysis-section">
            <h2>Novo Pé</h2>
            <div class="analysis-card" style="margin-bottom: 24px;">
                <div class="card-body">
                    <form action="/pes/new" method="POST">
                        <input type="hidden" id="id_talhao" name="id_talhao" value="<%= talhao.id_talhao %>">
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #351102;">Talhão</label>
                            <div style="padding: 10px; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9;">
                                <%= talhao.nome %>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label for="nome" style="display: block; margin-bottom: 8px; font-weight: 600; color: #351102;">Nome do Pé</label>
                            <input type="text" id="nome" name="nome" placeholder="Insira o nome do pé" required 
                                style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label for="observacoes" style="display: block; margin-bottom: 8px; font-weight: 600; color: #351102;">Observações</label>
                            <textarea id="observacoes" name="observacoes" placeholder="Insira as observações sobre o pé" 
                                    style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; min-height: 100px;"></textarea>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button type="submit" style="background: #65B741; color: #fff; font-weight: 600; border-radius: 8px; padding: 10px 40px; border: none; cursor: pointer; font-size: 16px;">
                                Cadastrar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <section class="analysis-section">
            <h2>Pés Cadastrados</h2>
            <div class="analysis-card">
                <div class="card-body">
                    <% if (pes && pes.length > 0) { %>
                        <table style="width: 100%; border-collapse: collapse; background: #fff; border-radius: 12px; overflow: hidden;">
                            <thead>
                                <tr style="background: #fff;">
                                    <th style="font-size: 15px; color: #351102; font-weight: 700; padding: 12px 15px; text-align: left;">Nome Pé</th>
                                    <th style="font-size: 15px; color: #351102; font-weight: 700; padding: 12px 15px; text-align: left;">Talhão</th>
                                    <th style="font-size: 15px; color: #351102; font-weight: 700; padding: 12px 15px; text-align: left;">Observações</th>
                                    <th style="width: 80px;"></th>
                                </tr>
                            </thead>
                            <tbody>
                                <% pes.forEach(pe => { %>
                                <tr style="border-bottom: 1px solid #F2C48D;">
                                    <td style="font-size: 15px; color: #351102; padding: 12px 15px;"><%= pe.nome %></td>
                                    <td style="font-size: 15px; color: #351102; padding: 12px 15px;"><%= pe.talhao.nome %></td>                            
                                    <td style="font-size: 15px; color: #351102; padding: 12px 15px;">
                                        <div style="max-height: 60px; overflow-y: auto; padding: 5px; border: 1px solid #eee; border-radius: 4px;">
                                            <%= pe.observacoes || 'Sem observações' %>
                                        </div>
                                    </td>
                                    <td style="text-align: right; padding: 12px 15px;">
                                        <a href="/pes/edit/<%= pe.id_pe %>" style="display: inline-block; background: none; border: none;">
                                            <img src="/imgs/btn-editar.svg" alt="Editar" style="width: 22px; height: 22px;">
                                        </a>
                                    </td>
                                </tr>
                                <% }) %>
                            </tbody>
                        </table>
                    <% } else { %>
                        <div class="empty-state" style="text-align: center; padding: 24px;">
                            <p style="color: #888; margin: 0;">Nenhum pé cadastrado neste talhão</p>
                        </div>
                    <% } %>
                </div>
            </div>
        </section>
    </section>
</main>
<%- include('partials/footer.ejs') %>
